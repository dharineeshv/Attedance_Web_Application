<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Custom Date Input</title>
    <style>
      body {
        background: #f4f4f4;
        font-family: Arial, sans-serif;
      }
      input[type="date"] {
        position: relative;
        padding: 10px;
        border: 2px solid #ccc;
        border-radius: 8px;
        font-size: 16px;
        outline: none;
        transition: 0.3s;
        background-color: white;
      }
      /* Hide the default calendar icon */
      input[type="date"]::-webkit-calendar-picker-indicator {
        cursor: pointer;
      }
      /* Optional: custom styling for focus */
      input[type="date"]:focus {
        border-color: #4caf50;
      }
      input {
        width: 80vw;
        text-align: center;
      }
      * {
        padding: 0;
        margin: 0;
      }
      .form {
        display: flex;
        justify-content: space-around;
        padding: 10px;
      }
      .container {
        display: flex;
        flex-direction: column;
        gap: 20px;
        justify-content: center;
        align-items: center;
      }
      .box {
        width: 80vw;
        border: 2px solid #ccc;
        padding: 10px;
        border-radius: 10px;
        display: grid;
        grid-template-columns: 1fr auto; /* text left, button right */
        align-items: center;
        background-color: white;
        gap: 10px;
      }

      button {
        padding: 8px;
        width: 100px;
        border: none;
        color: white;
        background-color: rgba(250, 5, 5, 0.832);
        border-radius: 10px;
      }
      h2 {
        text-align: center;
        padding: 2px;
      }
      .down {
        height: 1px;
        background-color: rgba(0, 0, 0, 0.1); /* soft gray line */
        width: 100%;
        grid-column: 1 / -1; /* make it span across the full grid width */
        margin-top: 15px; /* spacing above */
      }
      .status {
        display: flex;
        justify-content: space-between; /* left and right on same row */
        align-items: center;
        grid-column: 1 / -1; /* make it span full width in grid */
        margin-top: 10px;
        font-size: 14px;
        color: #333;
      }

      .left,
      .right {
        display: flex;
        align-items: center;
        gap: 5px; /* space between label and value */
      }

      .right b {
        color: #333;
      }

      .left b {
        color: #333;
      }
    </style>
  </head>
  <body>
    <h2>My Attendance</h2>
    <div class="form">
      <input type="date" id="dateInput" />
    </div>
    <div class="container">
      <!-- Box 1 -->
      <div class="box" id="box1">
        <b>08:45 am to 09:35 am</b>
        <button id="btn1">Absent</button>
        <div class="down"></div>
        <div class="status">
          <div class="left">
            <p>Marked by:</p>
            <b id="name1"></b>
          </div>
          <div class="right">
            <p>Time:</p>
            <b id="time1"></b>
          </div>
        </div>
      </div>

      <!-- Box 2 -->
      <div class="box" id="box2">
        <b>09:35 am to 10:25 am</b>
        <button id="btn2">Absent</button>
        <div class="down"></div>
        <div class="status">
          <div class="left">
            <p>Marked by:</p>
            <b id="name2"></b>
          </div>
          <div class="right">
            <p>Time:</p>
            <b id="time2"></b>
          </div>
        </div>
      </div>

      <!-- Box 3 -->
      <div class="box" id="box3">
        <b>10:40 am to 11:30 am</b>
        <button id="btn3">Absent</button>
        <div class="down"></div>
        <div class="status">
          <div class="left">
            <p>Marked by:</p>
            <b id="name3"></b>
          </div>
          <div class="right">
            <p>Time:</p>
            <b id="time3"></b>
          </div>
        </div>
      </div>

      <!-- Box 4 -->
      <div class="box" id="box4">
        <b>11:30 am to 12:20 pm</b>
        <button id="btn4">Absent</button>
        <div class="down"></div>
        <div class="status">
          <div class="left">
            <p>Marked by:</p>
            <b id="name4"></b>
          </div>
          <div class="right">
            <p>Time:</p>
            <b id="time4"></b>
          </div>
        </div>
      </div>

      <!-- Box 5 -->
      <div class="box" id="box5">
        <b>01:30 pm to 02:20 pm</b>
        <button id="btn5">Absent</button>
        <div class="down"></div>
        <div class="status">
          <div class="left">
            <p>Marked by:</p>
            <b id="name5"></b>
          </div>
          <div class="right">
            <p>Time:</p>
            <b id="time5"></b>
          </div>
        </div>
      </div>

      <!-- Box 6 -->
      <div class="box" id="box6">
        <b>02:20 pm to 03:10 pm</b>
        <button id="btn6">Absent</button>
        <div class="down"></div>
        <div class="status">
          <div class="left">
            <p>Marked by:</p>
            <b id="name6"></b>
          </div>
          <div class="right">
            <p>Time:</p>
            <b id="time6"></b>
          </div>
        </div>
      </div>

      <!-- Box 7 -->
      <div class="box" id="box7">
        <b>03:25 pm to 04:25 pm</b>
        <button id="btn7">Absent</button>
        <div class="down"></div>
        <div class="status">
          <div class="left">
            <p>Marked by:</p>
            <b id="name7"></b>
          </div>
          <div class="right">
            <p>Time:</p>
            <b id="time7"></b>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import {
    getDatabase,
    ref,
    set,
    onValue,
    get
  } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

  const appSetting = {
    databaseURL: "https://attendance-application-ead94-default-rtdb.firebaseio.com/",
  };
  const app = initializeApp(appSetting);
  const database = getDatabase(app);

  //________________________________________________________
  //databases...
  const student_otp_db = ref(database, "otp_by_student");
  const student_all_otp_details = ref(database, "student_day_wise_details");
  const teacher_otp_details  = ref(database,"teachers_otp");
  //_________________________________________________________

  const dateInput = document.getElementById("dateInput");

  //email of teacher.
  const teacher_email =  sessionStorage.getItem("email");

  //createdAt (time)
  let time ="";
  const teacher_otp = ""
  get(teacher_otp_db).then((snapshot) => {
        if (snapshot.exists())
        {
          const data = snapshot.val();
          for(let key in data)
          {
            if(teacher_email === data[key].email)
          {
               time = data[key].createdAt;
               teacher_otp = data[key].otp;
          }
          }

        }
  });
  let studentOtp=""
  let student_rollno ="";
  get(student_otp_db).then((snapshot) => {
        if (snapshot.exists())
        {
          const data = snapshot.val();
          for(let key in data)
          {
            if(data[key].student_otp === teacher_otp)
            {
              student_rollno = data[key].rollno;
              studentOtp = data[key].student_otp;
              break;
            }
          }
        }
});
let [timePart, ampm] = time.split(" "); // ["03:25", "PM"]
let [hours, minutes] = timePart.split(":"); 
hours = parseInt(hours); 
minutes = parseInt(minutes);


if(studentOtp===teacher_otp)
{
      if((hours===8 && (minutes>=45 && minutes<=59)) || (hours==9 && (minutes>=0 && minutes <=35)))
      {
        markPresent(1)
      }
      else if((hours===9 && (minutes>35 && minutes<=59)) || (hours==10 && (minutes>=0 && minutes <=25)))
      {
        markPresent(2)
      }
      else if((hours===10 && (minutes>=40 && minutes<=59)) || (hours==11 && (minutes>=0 && minutes <=30)))
      {
        markPresent(3)
      }
      else if((hours===11 && (minutes>30 && minutes<=59)) || (hours==12 && (minutes>=0 && minutes <=20)))
      {
        markPresent(4)
      }
      else if((hours===1 && (minutes>=30 && minutes<=59)) || (hours==2 && (minutes>=0 && minutes <=20)))
      {
        markPresent(5)
      }
      else if((hours===2 && (minutes>20 && minutes<=59)) || (hours==3 && (minutes>=0 && minutes <=10)))
      {
        markPresent(6)
      }
      else if((hours===3 && (minutes>=25 && minutes<=59)) || (hours==4 && (minutes>=0 && minutes <=25)))
      {
        markPresent(7)
      }
}

onValue(student_all_otp_details, (snapshot) => {
  if (snapshot.exists())
  {
      const data = snapshot.val();   
      for(let key in data)
      {
        if(data[key].rollno === student_rollno)
        {
           if(data[key].period1===true)
           {
             markPresent(1)
           }
           if(data[key].period2===true)
           {
             markPresent(2)
           }
           if(data[key].period3===true)
           {
             markPresent(3)
           }
           if(data[key].period4===true)
           {
             markPresent(4)
           }
           if(data[key].period5===true)
           {
             markPresent(5)
           }
           if(data[key].period6===true)
           {
             markPresent(6)
           }
           if(data[key].period7===true)
           {
             markPresent(7)
           }
        }
      }   
  }
  else
  {
    const details = {
      rollno:student_rollno,
      period1:false,
      period2:false,
      period3:false,
      period4:false,
      period5:false,
      period6:false,
      period7:false
    }
    push(student_all_otp_details,details);
  }
});


function markPresent(btnId) {
    const btn = document.querySelector(btnId);
    btn.textContent = "Present";
    btn.style.backgroundColor = "green";
    //want to update in db.
    
}

  function markAbsent(btnId) {
    const btn = document.querySelector(btnId);
    btn.textContent = "Absent";
    btn.style.backgroundColor = "rgba(250, 5, 5, 0.832)";
  }
</script>

<script
  src="https://kit.fontawesome.com/6045d1d2eb.js"
  crossorigin="anonymous"
></script>
