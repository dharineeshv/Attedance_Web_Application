<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Movement Pass</title>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
  />
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap");

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Roboto", sans-serif;
    }

    body {
      background: #f5f5f5;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .nav-container {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px 20px;
      background-color: #8a00ff;
      color: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
       position: fixed;
      top: 0;             
       left: 0;         
       width: 100%;         
  
    }

    .nav-container i {
      font-size: 1.2rem;
      cursor: pointer;
      transition: 0.2s;
    }

    .nav-container i:hover {
      transform: translateX(-3px);
    }

    .nav-container h2 {
      font-size: 1.4rem;
      font-weight: 600;
    }
   
  
.container {
  display: flex;
  flex-direction: column;
  margin: 80px auto 0 auto; /* top | left/right | bottom | left/right */
  width: 90%;
  gap:2px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);

}


    .container-1
    {
        display:flex;
        color:white;
        justify-content: space-between;
        background:#8800ff; 
        padding:20px;
        border-radius: 10px;
        
        
    }
    .container-2 
    {
        display:flex;
        gap:10px;
        justify-content: center;
        flex-direction: column;
        align-items: center;
        background:white;
        

    }
    button {
        background-color: rgba(255, 0, 0, 0.9);
        border:none;
        color:white;
        padding:8px;
        border-radius: 8px;
    }
   .container img{
        width: 100px;
        height: 100px;
        border-radius: 50%;
    }
    .container-2 b {
        font-weight:500;
        color:rgba(0, 0, 0, 0.688)
    }
   .container-3
   {
        display:flex;
        justify-content: space-between;
        padding:20px;
        background:white;
        border-radius: 10px;   
   }
   .c1 {
    display:flex;
    flex-wrap: wrap;
    flex-direction: column;
    gap:6px;
   }
   .c1 b {
    color:rgba(0, 0, 0, 0.588);
   }
   .c1 p 
   {
    font-weight: 600;
   }
    .timer {
        padding:20px;
        background:white;
        display:flex;
        justify-content: center;
    }
    .container-4 {
        display:flex;
        justify-content: space-between;
        padding:20px;
        background:white;
        border-radius: 10px;
        flex-direction: column;
    }
    .activity-status {
        display:flex;
        justify-content: space-between;
        align-items: center;
    }
    .approval-status {
        margin-top: 20px;
        display:flex;
        justify-content: center;
        border-radius: 8px;
        font-weight: 600;
    }
    #approved_btn_1{
         background-color: green;
    }
    #approved_btn_1:hover {
        transform: translateX(-3px);
    }
    #approved_btn{
         background-color: red;
    }
    #approved_btn:hover {
        transform: translateX(-3px);
    }
    /* ✅ Responsive adjustments for tablets and smaller screens */
@media (max-width: 768px) {
  .nav-container {
    padding: 12px 16px;
  }

  .nav-container h2 {
    font-size: 1.1rem;
  }

  .container {
    width: 95%;
  }

  .container-1 {
    padding: 15px;
  }

  .container-1 h2 {
    font-size: 1.1rem;
  }

  .container-1 button {
    font-size: 0.9rem;
    padding: 6px 10px;
  }

  .container-2 {
    padding: 15px;
  }

  .container-2 img {
    width: 90px;
    height: 90px;
  }

  .container-2 h2 {
    font-size: 1.1rem;
  }

  .container-2 b {
    font-size: 0.9rem;
  }

  .container-3 {
    gap: 12px;
    padding: 15px;
  }

  .c1 b {
    font-size: 0.9rem;
  }

  .c1 p {
    font-size: 0.95rem;
  }

  .container-4 {
    padding: 15px;
  }

  .activity-status b {
    font-size: 0.9rem;
  }

  .activity-status button {
    padding: 8px 10px;
    font-size: 0.9rem;
  }

  button {
    font-size: 0.9rem;
  }
}

/* ✅ Responsive adjustments for mobile phones */
@media (max-width: 480px) {
  .nav-container {
    padding: 10px 14px;
  }

  .nav-container i {
    font-size: 1rem;
  }

  .nav-container h2 {
    font-size: 1rem;
  }

  .container {
    width: 96%;
    margin-top: 70px;
  }

  .container-1 {
    padding: 12px;
  }

  .container-1 h2 {
    font-size: 1rem;
  }

  .container-1 button {
    font-size: 0.8rem;
    padding: 6px 8px;
  }

  .container-2 {
    padding: 12px;
  }

  .container-2 img {
    width: 75px;
    height: 75px;
  }

  .container-2 h2 {
    font-size: 1rem;
  }

  .container-2 b {
    font-size: 0.85rem;
  }

  .container-3 {
    padding: 12px;
    gap: 10px;
  }

  .c1 b {
    font-size: 0.85rem;
  }

  .c1 p {
    font-size: 0.9rem;
  }

  .container-4 {
    padding: 12px;
  }

  .activity-status b {
    font-size: 0.85rem;
  }

  .activity-status button {
    font-size: 0.85rem;
    padding: 7px 9px;
  }

  button {
    font-size: 0.85rem;
  }
}


  </style>
</head>
<body>
  
  <div class="nav-container">
    <i class="fa-solid fa-arrow-left"></i>
    <h2>Movement Pass Details</h2>
  </div>
<div class="container">
    <div class="container-1">
        <h2>Attendance Pass</h2>
        <button>Expired</button>
    </div>
    <div class="container-2">
           <img src="profile_image_for_project.png" alt="profile_picture">
           <h2 id="name"></h2>
           <b id="rollno"></b>
           <b id="dept"></b>
           <hr>
    </div>
    <div class="container-3">
           <div class="c1">
                <b >Date </b>
                <p id="date"></p>
           </div>
           <div class="c1">
                <b>Time </b>
                <p id="time"></p>
           </div>
           <div class="c1">
            <b>Purpose</b>
            <p id="purpose"></p>
           </div>
    </div>
    <div class="container-4">
      <div class="activity-status">
        <b>ID :#<span></span></b>
        <button id="approved_btn_1">Mark As Activated</button>
        <button id="approved_btn">Mark As Not Activated</button>
      </div>
        
    </div>
   
</div>

</body>
</html>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import {
    getDatabase,
    ref,
    set,
    onValue,
    get,
    push,
    update
  } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

  const appSetting = {
    databaseURL: "https://attendance-application-ead94-default-rtdb.firebaseio.com/",
  };
  const app = initializeApp(appSetting);
  const database = getDatabase(app);
 let key = sessionStorage.getItem("key");
 console.log(key);
 

 const passRef = ref(database, "student_movement_pass_details/" + key);

 
const departmentMap = {
  CT: "Computer Technology",
  CS: "Computer Science Engineering",
  IT: "Information Technology",
  AD: "Artificial Intelligence And Data Science",
  ME: "Mechanical Engineering",
  AL: "Artificial And Machine Learning",
  MB: "Master Of Business Administration",
  CB: "Computer Science And Business Systems",
  CD : "Computer Design",
  EE : "Electrical And Electronics",
  EC : "Electronics Communication Of Engineering",
  SE: "Information Science And Engineering",
  MT: "Master Of Technology"
};


let name = "";
  let rollno = "";
get(passRef).then(snapshot => {
    let date = document.getElementById("date");
    let time = document.getElementById("time");
    let purpose = document.getElementById("purpose");
  if (snapshot.exists()) {
    
    const data = snapshot.val();
     
      purpose.innerText = data.purpose;
    date.innerText = `${data.day} ${data.month} ${data.year}`;
    time.innerHTML = `${data.start_hour}:${data.start_minute} ${data.period1} to ${data.end_hour}:${data.end_minute} ${data.period2}`;
    document.querySelector(".activity-status b span").innerText = data.id;

     let name = data.name || "Unknown";
    let rollno = data.rollno || "";

    // Extract dept code safely from rollno (check length first)
    let deptCode = rollno.length >= 9 ? rollno.slice(7, 9) : "";

    // Map to full department name
    let department = departmentMap[deptCode] || "Unknown Department";

    // Update DOM elements
    document.getElementById("name").innerText = name;
    document.getElementById("rollno").innerText = rollno;
    document.getElementById("dept").innerText = department;

   
    if (data.status === "expired") {
  document.querySelector(".container-1 button").innerText = "Expired";
  document.querySelector(".container-1 button").style.backgroundColor = "red";
} else {
  document.querySelector(".container-1 button").innerText = "Active";
  document.querySelector(".container-1 button").style.backgroundColor = "green";
}

  }
});
   


  document.querySelector(".fa-arrow-left").addEventListener("click", () => {
    window.history.back();
  });








const approved_btn_1 = document.getElementById("approved_btn_1");
const approved_btn = document.getElementById("approved_btn");

approved_btn_1.addEventListener("click", () => {
  update(ref(database, "student_movement_pass_details/" + key), {
    activity_status: "activated",
    approved_by: sessionStorage.getItem("email") || "Unknown Teacher"
  }).then(() => {
    alert("Pass Activated Successfully!");
  }).catch(err => console.error("Activation Error:", err));
});

approved_btn.addEventListener("click", () => {
  update(ref(database, "student_movement_pass_details/" + key), {
    activity_status: "Not Activated"
  }).then(() => {
    alert("Pass Deactivated Successfully!");
  }).catch(err => console.error("Deactivation Error:", err));
});




</script>
